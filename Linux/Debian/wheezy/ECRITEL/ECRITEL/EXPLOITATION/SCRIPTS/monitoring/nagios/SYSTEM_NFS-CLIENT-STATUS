#!/usr/bin/env bash

## attention check pourrie ##

nberror=0

for value in $(grep -E "nfs(4){0,}" /etc/fstab | awk '{print$3}') ; do
        if echo "$value" | grep -q nfs4 ; then
                if ! mount -t nfs4 | grep -q "$value" ; then
                        nberror=1
                        errorvalue="$value"
                fi
        else
                if ! mount -t nfs | grep -q "$value" ; then
                        nberror=1
                        errorvalue="$value"
                fi
        fi

done

if (($nberror>0)) ; then
        echo "NOK: $errorvalue not mounted" ;
        exit 3
else
        echo "OK: all mount are enables" ;
        exit 1
fi
